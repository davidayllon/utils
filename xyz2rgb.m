function Xr = xyz2rgb(X)
% Rec. ITU-R BT.709-3 xyz2rgb
% Y = [
%     3.24479 -1.537150 -0.498535
%     -0.969256 1.875992 0.041556
%     0.055648 -0.204043 1.057311];
Y = [3.1336   -1.6168   -0.4907;
   -0.9787    1.9161    0.0335;
    0.0721   -0.2291    1.4054];
Xr = reshape((Y * [reshape(X(:, :, 1), 1, size(X, 1) * size(X, 2));...
				reshape(X(:, :, 2), 1, size(X, 1) * size(X, 2));...
				reshape(X(:, :, 3), 1, size(X, 1) * size(X, 2))])',...
			size(X));

val = min(Xr(:));
if (val < 0);
	Xr = Xr - val;
end;

% Rec. ITU-R BT.709-3 xyz2rgb, D65
% 3.2404542 -1.5371385 -0.4985314
% -0.9692660  1.8760108  0.0415560
%  0.0556434 -0.2040259  1.0572252
 
% Bradford-adapted, D50 matrices
%  3.1338561 -1.6168667 -0.4906146
% -0.9787684  1.9161415  0.0334540
%  0.0719453 -0.2289914  1.4052427
